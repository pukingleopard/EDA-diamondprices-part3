---
title: "Diamonds"
author: "James Hamilton"
date: "March 22, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
data(diamonds)
```

### Price Histograms with Facet and Color
Create a histogram of diamond prices. Facet the histogram by diamond color and use cut to color the histogram bars.
```{r}
ggplot(data = diamonds, aes(price)) +
   geom_histogram(aes(color=cut), binwidth = 100) +
   facet_wrap(~ color) +
   scale_fill_brewer(type = 'qual')
```

### Price vs. Table Colored by Cut
Create a scatterplot of diamond price vs. table and color the points by the cut of the diamond.
```{r}
ggplot(data = diamonds, aes(x = table, y = price)) +
   geom_point(aes(color=cut)) +
   scale_x_continuous(breaks = seq(50,70,1)) +
   coord_cartesian(xlim = c(50, 70))
```

### Price vs. Volume and Diamond Clarity
Create a scatterplot of diamond price vs. volume (x * y * z) and color the points by the clarity of diamonds. Use scale on the y-axis to take the log10 of price. You should also omit the top 1% of diamond volumes from the plot.
```{r}
diamonds$volume <- with(diamonds, x * y * z)
vol99q <- with(diamonds, quantile(volume, probs = c(.99)))
ggplot(data = subset(diamonds, volume <= vol99q),
   aes(x = volume, y = price)) +
   geom_point(alpha = 1/5, aes(color=clarity)) +
   scale_y_log10()
```

### Proportion of Friendships Initiated
Your task is to create a new variable called 'prop_initiated' in the Pseudo-Facebook data set. The variable should contain the proportion of friendships that the user initiated.
```{r}
pf <- read.csv("pseudo_facebook.tsv", sep = '\t')

pf$prop_initiated <- with(pf, ifelse(friend_count > 0, friendships_initiated / friend_count, 0))
```

### prop_initiated vs. tenure
Create a line graph of the median proportion of friendships initiated ('prop_initiated') vs.
tenure and color the line segment by year_joined.bucket.
```{r}
pf$year_joined <- with(pf, floor(2014 - tenure / 365))
pf$year_joined.bucket <- with(pf, cut(year_joined, breaks = c(2004,2009,2011,2012,2014)))

ggplot(data = subset(pf, prop_initiated > 0), aes(x = tenure, y = prop_initiated)) +
   geom_line(aes(color=year_joined.bucket), stat='summary', fun.y = median)
```

### Smoothing prop_initiated vs. tenure
Smooth the last plot you created of prop_initiated vs tenure colored by year_joined.bucket.
```{r}
ggplot(data = subset(pf, prop_initiated > 0), aes(x = tenure, y = prop_initiated)) +
   geom_line(aes(color=year_joined.bucket), stat='summary', fun.y = median) +
   geom_smooth()

prop_initiated.2012.2014 <- pf %>% filter(year_joined.bucket == "(2012,2014]")
mean(prop_initiated.2012.2014$prop_initiated)
```


